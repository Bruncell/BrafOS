
#include "graphic.h"
#include "consts.h"
#include "keyboard.h"



const static uint8_t font[256][10] = 
{

   [0x00] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
    },

   [0x01] = {
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b01000100,
       0b00000000,
       0b10000010,
       0b01111100,
       0b00000000,
       0b00000000,
    },

   [0x02] = {
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b01000100,
       0b00000000,
       0b01111100,
       0b10000010,
       0b00000000,
       0b00000000,
    },

   [0x03] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
       0b00111000,
       0b01111100,
       0b00111000,
       0b00010000,
    },

   [0x04] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x05] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x06] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x07] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x08] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x09] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x0A] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x0B] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x0C] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x0D]= { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x0E] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x0F] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x10] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x11] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x12] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x13] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x14] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x15] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x16] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x17] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x18] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x19] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x1A] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x1B] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x1C] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x1D] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },

   [0x1E] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },


   [0x1F] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },



   [0x21] = { 
       0b00000000,
       0b00010000,
       0b00010000,
       0b00010000,
       0b00010000,
       0b00010000,
       0b00010000,
       0b00010000,
       0b00000000,
       0b00010000,
    },



   [0x22] = { 
       0b00000000,
       0b00000000,
       0b00101000,
       0b00101000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
    },


   [0x23] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00100100,
       0b00100100,
       0b11111111,
       0b00100100,
       0b11111111,
       0b00100100,
       0b00110100,
    },



   [0x25] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000001,
       0b01100010,
       0b01100100,
       0b00001000,
       0b00010000,
       0b00100110,
       0b01000110,
    },


   [0x26] = { 
       0b00000000,
       0b00000000,
       0b00011100,
       0b00100010,
       0b00100100,
       0b00011000,
       0b00101010,
       0b01000110,
       0b01000110,
       0b00111001,
    },


   [0x27] = { 
       0b00000000,
       0b00000000,
       0b00010000,
       0b00010000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
    },


   [0x28] = { 
       0b00000000,
       0b00000000,
       0b00010000,
       0b00100000,
       0b01000000,
       0b01000000,
       0b01000000,
       0b01000000,
       0b00100000,
       0b00010000,
    },



   [0x29] = { 
       0b00000000,
       0b00000000,
       0b00010000,
       0b00001000,
       0b00000100,
       0b00000100,
       0b00000100,
       0b00000100,
       0b00001000,
       0b00010000,
    },


   [0x2A] = { 
       0b00000000,
       0b01010100,
       0b00111000,
       0b00111000,
       0b01010100,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
    },


   [0x2B] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
       0b00010000,
       0b01111100,
       0b00010000,
       0b00010000,
       0b00000000,
       0b00000000,
    },


   [0x2C] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00001000,
       0b00010000,
    },


   [0x2E] = { 
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00000000,
       0b00010000,
    },
       
       
       
    [0x24] = { // $
        0b00000000,
        0b00010000,
        0b00111000,
        0b01010100,
        0b01010000,
        0b00111000,
        0b00010100,
        0b01010100,
        0b00111000,
        0b00010000,
     },

     [0x31] = { // 1
         0b00000000,
         0b00001000,
         0b00011000,
         0b00101000,
         0b00001000,
         0b00001000,
         0b00001000,
         0b00001000,
         0b00001000,
         0b00111110,
      },

	  [0x32] = { // 2
         0b00000000,
         0b00111100,
         0b01000010,
         0b01000010,
         0b00000010,
         0b00000100,
         0b00001000,
         0b00010000,
         0b00100000,
         0b01111110,
     },

	  [0x33] = { // 5
         0b00000000,
         0b00111000,
         0b01000100,
         0b00000100,
         0b00000100,
         0b00111100,
         0b00000010,
         0b00000010,
         0b10000010,
         0b01111100,
     },

      [0x34] = { // 4
         0b00000000,
         0b00000100,
         0b00001100,
         0b00010100,
         0b00100100,
         0b01000100,
         0b11111110,
         0b00000100,
         0b00000100,
         0b00000100,
     },

     [0x35] = { // 5
        0b00000000,
        0b01111110,
        0b01000000,
        0b01000000,
        0b01000000,
        0b01111100,
        0b00000010,
        0b00000010,
        0b01000010,
        0b00111100,
     },

     [0x36] = { // 6
          0b00000000,
          0b00111100,
          0b01000010,
          0b01000000,
          0b01000000,
          0b01111100,
          0b01000010,
          0b01000010,
          0b01000010,
          0b00111100,
       },

     [0x37] = { // 7
          0b00000000,
          0b01111110,
          0b00000010,
          0b00000010,
          0b00000100,
          0b00000100,
          0b00001000,
          0b00001000,
          0b00010000,
          0b00010000,
       },

     [0x38] = { // 8
          0b00000000,
          0b00011000,
          0b00100100,
          0b00100100,
          0b00011000,
          0b00100100,
          0b01000010,
          0b01000010,
          0b01000010,
          0b00111100,
       },  

     [0x39] = { // 9
          0b00000000,
          0b00111100,
          0b01000010,
          0b01000010,
          0b01000010,
          0b01000010,
          0b00111110,
          0b00000010,
          0b01000010,
          0b00111100,
       },

     [0x40] = { // @
          0b00000000,
          0b00000000,
          0b00111110,
          0b01000001,
          0b10001111,
          0b10010001,
          0b10010001,
          0b10001111,
          0b01000001,
          0b00111100,
       },

     [0x30] = { // 0
          0b00000000,
          0b00111100,
          0b01000010,
          0b01000010,
          0b01000010,
          0b01000010,
          0b01000010,
          0b01000010,
          0b01000010,
          0b00111100,
       },                



    [0x61] = { // a
        0b00000000,
        0b00000000,
        0b00000000,
        0b01111000,
        0b10000100,
        0b00000100,
        0b01111100,
        0b10000100,
        0b10000100,
        0b01111010,
    },


   [0x62] = { // b
        0b00000000,
        0b00000000,
        0b11000000,
        0b01000000,
        0b01000000,
        0b01011100,
        0b01100010,
        0b01000010,
        0b01100010,
        0b11011100,
    },

    [0x63] = { // c
        0b00000000,
        0b00000000,
        0b00000000,
        0b00111000,
        0b01000100,
        0b10000000,
        0b10000000,
        0b10000000,
        0b01000100,
        0b00111000,
    },

    [0x64] = { // d
         0b00000000,
         0b00000000,
         0b00000100,
         0b00000100,
         0b00000100,
         0b01110100,
         0b10001100,
         0b10000100,
         0b10001100,
         0b01110110,
     },

     [0x65] = { // e
         0b00000000,
         0b00000000,
         0b00000000,
         0b01111000,
         0b10000100,
         0b10000100,
         0b11111100,
         0b10000000,
         0b10000100,
         0b01111000,
     },

     [0x66] = { // f
         0b00000000,
         0b00000000,
         0b00111000,
         0b01000100,
         0b01000000,
         0b01000000,
         0b11110000,
         0b01000000,
         0b01000000,
         0b01000000,
     },

     [0x67] = { // g
         0b00000000,
         0b00000000,
         0b01111110,
         0b10000100,
         0b10000100,
         0b10000100,
         0b01111100,
         0b00000100,
         0b01000100,
         0b00111000,
     },

     [0x68] = { // h
         0b00000000,
         0b00000000,
         0b11100000,
         0b01000000,
         0b01000000,
         0b01011000,
         0b01100100,
         0b01000100,
         0b01000100,
         0b11101110,
     },

     [0x69] = { // i
          0b00000000,
          0b00010000,
          0b00000000,
          0b00110000,
          0b00010000,
          0b00010000,
          0b00010000,
          0b00010000,
          0b00010000,
          0b00111000,
      },


     [0x6A] = { // j
         0b00000000,
         0b00000100,
         0b00000000,
         0b00001100,
         0b00000100,
         0b00000100,
         0b00000100,
         0b01000100,
         0b01000100,
         0b00111000,
     },

     [0x6B] = { // k
         0b00000000,
         0b00000000,
         0b11000000,
         0b01001100,
         0b01010000,
         0b01100000,
         0b01010000,
         0b01001000,
         0b01000100,
         0b11000010,
     },

    [0x6C] = { // l
        0b00000000,
        0b00000000,
        0b01110000,
        0b00010000,
        0b00010000,
        0b00010000,
        0b00010000,
        0b00010000,
        0b00010000,
        0b01111100,
    },

    [0x6E] = { // n
         0b00000000,
         0b00000000,
         0b00000000,
         0b11011100,
         0b01100010,
         0b01000010,
         0b01000010,
         0b01000010,
         0b01000010,
         0b11100111,
     },

    [0x6D] = { // m
         0b00000000,
         0b00000000,
         0b00000000,
         0b11101100,
         0b10010010,
         0b10010010,
         0b10010010,
         0b10010010,
         0b10010010,
         0b10010010,
     },

    [0x6F] = { // o
         0b00000000,
         0b00000000,
         0b00000000,
         0b01111000,
         0b10000100,
         0b10000100,
         0b10000100,
         0b10000100,
         0b10000100,
         0b01111000,
     },
     
    

     [0x70] = { // p
          0b00000000,
          0b00000000,
          0b00000000,
          0b11011100,
          0b01100010,
          0b01100010,
          0b01011100,
          0b01000000,
          0b01000000,
          0b11100000,
      },
      
    [0x71] = { // q
        0b00000000,
        0b00000000,
        0b00000000,
        0b00111100,
        0b01000010,
        0b01000010,
        0b01000010,
        0b00111110,
        0b00000010,
        0b00000010,
    },

    [0x72] = { // r
        0b00000000,
        0b00000000,
        0b00000000,
        0b01101100,
        0b00110010,
        0b00100000,
        0b00100000,
        0b00100000,
        0b00100000,
        0b01111000,
    },

      [0x73] = { // s
          0b00000000,
          0b00000000,
          0b00000000,
          0b00111000,
          0b01000100,
          0b01000000,
          0b00111000,
          0b00000100,
          0b01000100,
          0b00111000,
      },

     [0x74] = { // t
          0b00000000,
          0b00100000,
          0b00100000,
          0b00100000,
          0b01111000,
          0b00100000,
          0b00100000,
          0b00100000,
          0b00100010,
          0b00011100,
      },
 


      [0x75] = { // u
          0b00000000,
          0b00000000,
          0b00000000,
          0b11001100,
          0b01000100,
          0b01000100,
          0b01000100,
          0b01000100,
          0b01000100,
          0b00111010,
      },

     [0x76] = { // v
          0b00000000,
          0b00000000,
          0b00000000,
          0b10000010,
          0b10000010,
          0b01000100,
          0b01000100,
          0b00101000,
          0b00101000,
          0b00010000,
      },

      [0x77] = { // w
          0b00000000,
          0b00000000,
          0b00000000,
          0b10000010,
          0b10000010,
          0b10010010,
          0b10010010,
          0b10010010,
          0b10101010,
          0b01000100,
      },

      [0x78] = { //x
          0b00000000,
          0b00000000,
          0b00000000,
          0b10000010,
          0b01000100,
          0b00101000,
          0b00010000,
          0b00101000,
          0b01000100,
          0b10000010,
      },



     [0x79] = { // y
          0b00000000,
          0b00000000,
          0b00000000,
          0b11100111,
          0b01000010,
          0b00100010,
          0b00011100,
          0b00000100,
          0b01001000,
          0b00110000,
      },
      
     [0x7A] = { // y
          0b00000000,
          0b00000000,
          0b00000000,
          0b01111110,
          0b00000100,
          0b00001000,
          0b00010000,
          0b00100000,
          0b01000000,
          0b01111110,
      },

      
      [0x2D] = { // /
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b01111100,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
       },
      
      [0x2F] = { // /
           0b00000110,
           0b00001100,
           0b00001000,
           0b00011000,
           0b00010000,
           0b00110000,
           0b01100000,
           0b01000000,
           0b11000000,
           0b10000000,
       },

       [0x20] = { // space
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
           0b00000000,
       },

};


uint16_t rgb555(uint8_t r, uint8_t g, uint8_t b) 
{
    return ((r & 0x1F) << 10) | ((g & 0x1F) << 5) | (b & 0x1F);
}

void pix(int x, int y, uint32_t color) 
{

    uint16_t* fb = (uint16_t*)FRAMEBUFFER;
    fb[y * (PITCH / 2) + x] = color;
}

void DrawLetter(int CursoX, int CursoY, uint32_t FrontColor, uint32_t BackColor, uint8_t LetterID)
{

CursoX *= 8;    // Font 8x10
CursoY *=10;

int temp_x = CursoX;

	for(int i = 0; i < 10; i++)
	{
		uint8_t bits = font[LetterID][i];
		 
	for(int j = 0; j < 8; j++)
 	{				
	uint8_t bit = (bits >> (7 - j)) & 1;
	uint32_t color = bit ? FrontColor : BackColor;
						
	pix(CursoX, CursoY, color);
  				 	 
  				 	    
	CursoX++;	
	}
	CursoX = temp_x;
	CursoY++;
	}
}


inline void Print(int CursorX, int CursorY, uint32_t FrontColor, uint32_t BackColor, const char *word)
{
int i = 0;
while(word[i] != 0)
{
if(word[i] == 0x0D)
{
CursorY++;
CursorX = 0;
i+=1;
}

DrawLetter(CursorX, CursorY, FrontColor, BackColor, word[i]);

CursorX++; 

if (CursorX >= WIDTH / 8) 
{
CursorX = 0;
CursorY++;
}
	
i++;

}
	
}

